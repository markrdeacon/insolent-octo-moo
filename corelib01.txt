Some core functionality on master branch.

Changing some core functionality.

Bug fixed here.
